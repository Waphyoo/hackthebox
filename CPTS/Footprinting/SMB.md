## Server Message Block (SMB) 


## 1. SMB ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**Server Message Block (SMB)** ‡πÄ‡∏õ‡πá‡∏ô client-server protocol ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢:
- **‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå** - ‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- **‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢** - ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå, ‡πÄ‡∏£‡∏≤‡πÄ‡∏ï‡∏≠‡∏£‡πå
- **‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£** - ‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ

### ‡∏ó‡∏µ‡πà‡∏°‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ß‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£
- **‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î**: ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ Microsoft ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö OS/2 (LAN Manager, LAN Server)
- **‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å**: Windows operating systems ‡∏ó‡∏∏‡∏Å‡∏£‡∏∏‡πà‡∏ô
- **Backward Compatible**: Windows ‡∏£‡∏∏‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏£‡∏∏‡πà‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏î‡πâ
- **Cross-Platform**: Samba project ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Linux/Unix ‡πÉ‡∏ä‡πâ SMB ‡πÑ‡∏î‡πâ

---

## 2. SMB ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
```
Client ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£
   ‚Üì
Server ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ SMB server application
   ‚Üì
Handshake ‚Üí ‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô messages ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
   ‚Üì
TCP/IP ‚Üí ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô three-way handshake
```



## 3. SMB Shares ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå

### ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î Shares
- **Server** ‡πÅ‡∏ä‡∏£‡πå‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á file system ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤
- **Client** ‡πÄ‡∏´‡πá‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏ö‡∏ô server
- **‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á** ‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö 2 ‡∏ä‡∏±‡πâ‡∏ô: **SMB permissions** ‡πÅ‡∏•‡∏∞ **Local file permissions**

### ‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå (‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ä‡∏±‡πâ‡∏ô)

**Scenario 1: SMB ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï ‚úì ‡πÅ‡∏ï‡πà Local ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò ‚úó**
```bash
SMB Share ACL: john = Full Control
Local File: owner=root, permissions=700
‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‚ùå john ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (Local blocking)
```

**Scenario 2: SMB ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò ‚úó ‡πÅ‡∏ï‡πà Local ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï ‚úì**
```bash
SMB Share ACL: mary = No Access
Local File: owner=mary, permissions=755
‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‚ùå mary ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (SMB blocking)
```

**Scenario 3: ‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï ‚úì‚úì**
```bash
SMB Share ACL: alice = Read/Write
Local File: group=staff, alice ‚àà staff, permissions=770
‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‚úÖ alice ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ
```

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£**: ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠ **SMB ‡πÅ‡∏•‡∏∞ Local ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà**

---

## 4. CIFS ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**Common Internet File System (CIFS)** ‡∏Ñ‡∏∑‡∏≠:
- **Dialect (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞) ‡∏Ç‡∏≠‡∏á SMB** ‡∏ó‡∏µ‡πà Microsoft ‡∏û‡∏±‡∏í‡∏ô‡∏≤
- ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö **SMB version 1** 
- ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Windows systems
- ‡∏°‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏ß‡πà‡∏≤ **SMB/CIFS**

### ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô
- ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤ ‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
- ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤ compatibility

---

## 5. Samba ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**Samba** ‡πÄ‡∏õ‡πá‡∏ô open-source implementation ‡∏Ç‡∏≠‡∏á SMB protocol ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Unix/Linux:
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Linux/Unix ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ö Windows ‡πÑ‡∏î‡πâ
- ‡πÉ‡∏ä‡πâ CIFS protocol ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ
- ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ó‡∏ô Microsoft SMB server

### ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 3 ‡∏ï‡∏±‡∏ß
```
SMB Protocol (Microsoft original)
‚îÇ
‚îú‚îÄ‚îÄ CIFS (dialect = SMB v1 specific implementation)
‚îÇ   ‚îî‚îÄ‚îÄ ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Windows environments
‚îÇ
‚îî‚îÄ‚îÄ Samba (open-source alternative)
    ‚îî‚îÄ‚îÄ ‡πÉ‡∏ä‡πâ CIFS ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö Windows
```

---

## 6. NetBIOS ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö SMB

### NetBIOS ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?
**Network Basic Input/Output System** ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£:
- **Naming service** - ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå
- **Session service** - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
- **Datagram service** - ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

### ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö SMB

**‡∏¢‡∏∏‡∏Ñ‡πÄ‡∏Å‡πà‡∏≤ (SMB 1)**:
- SMB ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ö‡∏ô **NetBIOS over TCP/IP** (NetBT)
- ‡πÉ‡∏ä‡πâ NetBIOS ‡πÄ‡∏õ‡πá‡∏ô transport layer
- NetBIOS ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á session

**‡∏¢‡∏∏‡∏Ñ‡πÉ‡∏´‡∏°‡πà (SMB 2.0+)**:
- SMB ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏ö‡∏ô TCP/IP ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏∂‡πà‡∏á NetBIOS
- NetBIOS ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏°‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤ (backward compatibility)

---

## 7. Ports ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£

### ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö

| Protocol | Ports | ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö | ‡∏¢‡∏∏‡∏Ñ |
|----------|-------|-----------|-----|
| **NetBIOS over TCP** | 137, 138, 139 | Legacy SMB ‡∏ú‡πà‡∏≤‡∏ô NetBIOS layer | ‡πÄ‡∏Å‡πà‡∏≤ |
| **SMB Direct** | 445 | SMB/CIFS ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏ö‡∏ô TCP/IP | ‡πÉ‡∏´‡∏°‡πà |

### ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î Ports

**Ports 137-139 (NetBIOS)**
- ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ SMB ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô NetBIOS
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤
- ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö Samba ‡πÉ‡∏ô legacy mode

**Port 445 (Direct SMB)**
- CIFS/SMB ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô NetBIOS layer
- ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÉ‡∏ô modern systems

---

## 8. SMB Versions ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤

### Timeline ‡∏ß‡∏¥‡∏ß‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£

**SMB 1.0 / CIFS**
- ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏£‡∏Å ‡∏°‡∏µ‡∏°‡∏≤‡∏ô‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
- ‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏°‡∏≤‡∏Å
- ‚ö†Ô∏è Microsoft ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
- ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô

**SMB 2.0 / 2.1**
- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å
- ‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô commands ‡πÅ‡∏•‡∏∞ subcommands
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö features ‡πÉ‡∏´‡∏°‡πà

**SMB 3.0 / 3.1.1** (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)
- **‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ end-to-end** (encryption)
- ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Remote Direct Memory Access (RDMA)
- ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÉ‡∏ô Windows 10/11 ‡πÅ‡∏•‡∏∞ Server 2016+

### ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á

| Feature | SMB 1 | SMB 2 | SMB 3 |
|---------|-------|-------|-------|
| ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ | ‚ö†Ô∏è ‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠ | ‚úì ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô | ‚úÖ ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á |
| ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û | ‡∏ï‡πà‡∏≥ | ‡∏Å‡∏•‡∏≤‡∏á | ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å |
| ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ | ‡πÑ‡∏°‡πà‡∏°‡∏µ | ‡∏à‡∏≥‡∏Å‡∏±‡∏î | ‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö |
| ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ä‡πâ | ‚ùå | ‚ö†Ô∏è | ‚úÖ |

---

## ‡∏™‡∏£‡∏∏‡∏õ: ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

```
Application Layer
    ‚Üì
SMB Protocol (‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏ü‡∏•‡πå/‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£)
    ‚îú‚îÄ‚îÄ Implementations
    ‚îÇ   ‚îú‚îÄ‚îÄ Microsoft SMB (Windows)
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CIFS (SMB v1 dialect)
    ‚îÇ   ‚îî‚îÄ‚îÄ Samba (Linux/Unix alternative)
    ‚îÇ
    ‚îî‚îÄ‚îÄ Transport Methods
        ‚îú‚îÄ‚îÄ Legacy: ‡∏ú‡πà‡∏≤‡∏ô NetBIOS (ports 137-139)
        ‚îî‚îÄ‚îÄ Modern: Direct TCP/IP (port 445)
    ‚Üì
TCP/IP Layer
    ‚Üì
Network/Physical Layer
```

**Key Takeaway**: SMB ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏õ‡∏£‡πÇ‡∏ï‡∏Ñ‡∏≠‡∏•‡∏´‡∏•‡∏±‡∏Å, CIFS ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á SMB v1, Samba ‡πÄ‡∏õ‡πá‡∏ô implementation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Linux/Unix, ‡πÅ‡∏•‡∏∞ NetBIOS ‡πÄ‡∏õ‡πá‡∏ô transport layer ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà SMB ‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ‡πÅ‡∏ï‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏ö‡∏ô TCP/IP ‡πÅ‡∏•‡πâ‡∏ß

![alt text](image-1.png)





### ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
```bash
smbstatus
```

### ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á

```
Samba version 4.11.6-Ubuntu

PID    Username   Group    Machine              Protocol    Encryption  Signing
--------------------------------------------------------------------------------
75691  sambauser  samba    10.10.14.4          SMB3_11     -           -

Service   pid    Machine      Connected at              Encryption  Signing
---------------------------------------------------------------------------
notes     75691  10.10.14.4   Do Sep 23 00:12:06 2021  -           -

No locked files
```

---

## üìä ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢

| ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ | ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á |
|--------|----------|----------|
| **PID** | Process ID ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ | 75691 |
| **Username** | ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ | sambauser |
| **Group** | ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ | samba |
| **Machine** | IP address ‡∏Ç‡∏≠‡∏á client | 10.10.14.4 |
| **Protocol Version** | ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô SMB ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ | SMB3_11 |
| **Service** | Share ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á | notes |
| **Connected at** | ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ | Do Sep 23 00:12:06 2021 |
| **Encryption** | ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà | - (‡πÑ‡∏°‡πà‡∏°‡∏µ) |
| **Signing** | ‡∏°‡∏µ‡∏Å‡∏≤‡∏£ sign packets ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà | - (‡πÑ‡∏°‡πà‡∏°‡∏µ) |

---

## üéØ ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ `smbstatus`

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Administrator
- ‚úÖ **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á shares**
- ‚úÖ **‡πÄ‡∏´‡πá‡∏ô IP address ‡∏Ç‡∏≠‡∏á clients**
- ‚úÖ **‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ share ‡πÑ‡∏´‡∏ô‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô**
- ‚úÖ **‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥**

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Penetration Tester
- üî¥ **‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢**
- üî¥ **‡πÄ‡∏´‡πá‡∏ô active connections**
- üî¥ **‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏ï‡πà‡∏≠‡πÑ‡∏õ** (‡πÄ‡∏ä‡πà‡∏ô lateral movement)
- üî¥ **‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏ñ‡∏π‡∏Å‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï** (‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ admin ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà)

---

## üè¢ Domain-Level Security

### ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î
```
Samba Server ‚Üí ‡πÄ‡∏õ‡πá‡∏ô member ‡∏Ç‡∏≠‡∏á Windows Domain
       ‚Üì
Domain Controller (Windows NT Server)
       ‚Üì
‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ authentication ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
```

### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

**1. Domain Controller ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:**
- ‡πÄ‡∏õ‡πá‡∏ô **password server** ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á domain
- ‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• users ‡πÅ‡∏•‡∏∞ passwords
- Authenticate ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà login

**2. ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:**

| Database | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ | ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á |
|----------|----------|---------|
| **NTDS.dit** | Active Directory database | Domain Controller |
| **SAM** (Security Authentication Module) | Local user database | Windows machines |

**3. ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ Authentication:**

```
User ‚Üí Login ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
  ‚Üì
Domain Controller ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö NTDS.dit/SAM
  ‚Üì
‡∏ú‡πà‡∏≤‡∏ô ‚Üí ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö token
  ‚Üì
‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á shares ‡∏ö‡∏ô Samba ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏ô domain
```

---

## üîê ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏î‡πâ‡∏≤‡∏ô Security

### ‡∏à‡∏≤‡∏Å `smbstatus` ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤:

```
Encryption: -    (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™)
Signing: -       (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ sign)
```

**‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤:**
- ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö plain text
- ‚ö†Ô∏è ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠ man-in-the-middle attacks
- ‚ö†Ô∏è ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠ credential sniffing
- ‚ö†Ô∏è ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ replay attacks ‡πÑ‡∏î‡πâ

### ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ:
```ini
# ‡πÉ‡∏ô smb.conf
server signing = mandatory
smb encrypt = required
```

---

## üí° Use Case ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

### Scenario: Penetration Testing

> "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà subnet (‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô isolated network) ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏¢‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ"

**‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ `smbstatus`:**

1. **‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢**
   - ‡πÄ‡∏´‡πá‡∏ô active users
   - ‡πÄ‡∏´‡πá‡∏ô IP addresses

2. **‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô Lateral Movement**
   - Target users ‡∏ó‡∏µ‡πà‡∏°‡∏µ privileges ‡∏™‡∏π‡∏á
   - ‡∏ï‡∏≤‡∏° sessions ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô

3. **‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏ö**
   - ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ admin ‡∏Å‡∏≥‡∏•‡∏±‡∏á monitor
   - ‡∏õ‡∏£‡∏±‡∏ö tactics ‡πÉ‡∏´‡πâ stealthy ‡∏Ç‡∏∂‡πâ‡∏ô

4. **‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Domain**
   - ‡∏£‡∏π‡πâ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á domain
   - ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° attack ‡∏ï‡πà‡∏≠ Domain Controller

---
