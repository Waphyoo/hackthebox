# Catching Files over HTTP/S

## ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (Overview)

### ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ HTTP/HTTPS?

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏´‡∏•‡∏±‡∏Å:**

1. **Protocol ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î**
   - Firewalls ‡∏°‡∏±‡∏Å‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï HTTP/HTTPS
   - ‡πÄ‡∏õ‡πá‡∏ô Protocol ‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢

2. **‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (HTTPS)**
   - ‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á
   - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Network IDS ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå sensitive

### ‚ö†Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á
‡∏´‡∏≤‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå sensitive (‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô) ‡∏ú‡πà‡∏≤‡∏ô **plaintext HTTP** ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™:
- Network IDS ‡∏≠‡∏≤‡∏à‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ
- ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≤‡∏à‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
- ‡∏≠‡∏≤‡∏à‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö

---

## Nginx - Enabling PUT Method

### ‡∏ó‡∏≥‡πÑ‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Nginx ‡πÅ‡∏ó‡∏ô Apache?

| ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥ | Nginx | Apache |
|-----------|-------|--------|
| **Configuration** | ‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤ | ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏ß‡πà‡∏≤ |
| **Security** | ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Å‡∏ß‡πà‡∏≤ | Module system ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á |
| **PHP Execution** | ‡∏¢‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢) | ‡∏á‡πà‡∏≤‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á) |

### üö® ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏≠‡∏á Apache:**
- PHP Module ‡∏£‡∏±‡∏ô**‡∏ó‡∏∏‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ .php**
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏≤‡∏à‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Web Shell ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô‡πÑ‡∏î‡πâ
- ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á Nginx:**
- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ PHP ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏ß‡πà‡∏≤
- ‡∏•‡∏î**‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î**‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÑ‡∏õ‡∏™‡∏π‡πà‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà

---

## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Nginx Upload Server

### 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Directory ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î

```bash
sudo mkdir -p /var/www/uploads/SecretUploadDirectory
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- `-p`: ‡∏™‡∏£‡πâ‡∏≤‡∏á parent directories ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
- `SecretUploadDirectory`: ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

---

### 2. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Owner ‡πÄ‡∏õ‡πá‡∏ô www-data

```bash
sudo chown -R www-data:www-data /var/www/uploads/SecretUploadDirectory
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- `chown`: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ownership
- `-R`: Recursive (‡∏ó‡∏∏‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏†‡∏≤‡∏¢‡πÉ‡∏ô)
- `www-data:www-data`: User ‡πÅ‡∏•‡∏∞ Group ‡∏ó‡∏µ‡πà Nginx ‡πÉ‡∏ä‡πâ

---

### 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Configuration

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå:** `/etc/nginx/sites-available/upload.conf`

```nginx
server {
    listen 9001;
    
    location /SecretUploadDirectory/ {
        root    /var/www/uploads;
        dav_methods PUT;
    }
}
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ Configuration:**

| Parameter | ‡∏Ñ‡πà‡∏≤ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ |
|-----------|-----|----------|
| `listen` | 9001 | ‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏ó‡∏µ‡πà Nginx ‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á |
| `location` | /SecretUploadDirectory/ | URL path ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î |
| `root` | /var/www/uploads | ‡πÑ‡∏î‡πÄ‡∏£‡∏Å‡∏ó‡∏≠‡∏£‡∏µ‡∏´‡∏•‡∏±‡∏Å |
| `dav_methods` | PUT | ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï HTTP PUT method |

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:**
- URL ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô: `http://server:9001/SecretUploadDirectory/`
- ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô: `/var/www/uploads/SecretUploadDirectory/`

---

### 4. ‡∏™‡∏£‡πâ‡∏≤‡∏á Symbolic Link

```bash
sudo ln -s /etc/nginx/sites-available/upload.conf /etc/nginx/sites-enabled/
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- `ln -s`: ‡∏™‡∏£‡πâ‡∏≤‡∏á symbolic link
- `sites-available`: ‡πÑ‡∏ü‡∏•‡πå config ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- `sites-enabled`: config ‡∏ó‡∏µ‡πà active ‡∏≠‡∏¢‡∏π‡πà

**‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Nginx:**
```
/etc/nginx/
‚îú‚îÄ‚îÄ sites-available/     (‡πÄ‡∏Å‡πá‡∏ö config ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
‚îÇ   ‚îî‚îÄ‚îÄ upload.conf
‚îî‚îÄ‚îÄ sites-enabled/       (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ config ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)
    ‚îî‚îÄ‚îÄ upload.conf -> ../sites-available/upload.conf
```

---

### 5. Start/Restart Nginx

```bash
sudo systemctl restart nginx.service
```

---

## ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Port 80 Already in Use

**‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Error Log:**
```bash
tail -2 /var/log/nginx/error.log
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
```
bind() to 0.0.0.0:80 failed (98: Address already in use)
still could not bind()
```

---

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

#### **1. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏≠‡∏£‡πå‡∏ï 80 ‡∏≠‡∏¢‡∏π‡πà:**

```bash
ss -lnpt | grep 80
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
```
LISTEN 0 100 0.0.0.0:80 0.0.0.0:* users:(("python",pid=2811,fd=3))
```

#### **2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Process:**

```bash
ps -ef | grep 2811
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
```
user65  2811  1856  0 16:05 ?  00:00:04 python -m websockify 80 localhost:5901 -D
```

#### **3. ‡∏•‡∏ö Default Nginx Configuration:**

```bash
sudo rm /etc/nginx/sites-enabled/default
```

**‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:**
- Default config ‡∏Ç‡∏≠‡∏á Nginx bind ‡∏Å‡∏±‡∏ö‡∏û‡∏≠‡∏£‡πå‡∏ï 80
- ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏û‡∏≠‡∏£‡πå‡∏ï 9001 ‡πÅ‡∏ó‡∏ô ‡∏à‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ default config

#### **4. Restart Nginx:**

```bash
sudo systemctl restart nginx.service
```

---

## ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå

### ‡πÉ‡∏ä‡πâ cURL ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î

```bash
curl -T /etc/passwd http://localhost:9001/SecretUploadDirectory/users.txt
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ Parameters:**
- `-T`: ‡πÉ‡∏ä‡πâ HTTP PUT method ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
- `/etc/passwd`: ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
- `http://localhost:9001/SecretUploadDirectory/users.txt`: URL ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á

---

### ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

```bash
sudo tail -1 /var/www/uploads/SecretUploadDirectory/users.txt
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
```
user65:x:1000:1000:,,,:/home/user65:/bin/bash
```

‚úÖ **‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!** ‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤‡∏ó‡∏µ‡πà server ‡πÅ‡∏•‡πâ‡∏ß

---

